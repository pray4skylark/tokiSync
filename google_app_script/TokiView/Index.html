<!DOCTYPE html>
<html>

<head>
    <base target="_top">
    <title>TokiLibrary</title>
    <meta charset="utf-8">
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@300;500;700&display=swap" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>
    
    <!-- PWA Meta Tags -->
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="theme-color" content="#1a1a1a">
    <link rel="apple-touch-icon" href="https://github.com/user-attachments/assets/99f5bb36-4ef8-40cc-8ae5-e3bf1c7952ad">
    <link rel="icon" type="image/png"
        href="https://github.com/user-attachments/assets/99f5bb36-4ef8-40cc-8ae5-e3bf1c7952ad">

    <!-- CSS Module -->
    <?!= include('Styles'); ?>
</head>

<body>
    <!-- Page Loader -->
    <div id="pageLoader" class="page-loader">
        <div class="spinner"></div>
        <div id="loaderMsg" style="color:var(--sub)">ë‚´ ì„œì¬ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘ì…ë‹ˆë‹¤...</div>
    </div>

    <!-- Viewer Overlay -->
    <div id="viewerOverlay" class="viewer-overlay">
        <div class="viewer-header">
            <span id="viewerTitle">Viewer</span>
            <button onclick="closeViewer()" style="background:none; border:none; color:white; font-size:24px; cursor:pointer;">&times;</button>
        </div>
        <div id="viewerContent" class="viewer-content">
            <!-- Viewer Content dynamically injected -->
        </div>
    </div>

    <!-- Episode List Modal -->
    <div id="episodeModal" class="modal-overlay">
        <div class="modal-box" style="width: 500px; max-width:90%;">
            <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:20px;">
                 <div class="modal-title" style="margin-bottom:0;">ğŸ“„ íšŒì°¨ ëª©ë¡</div>
                 <button onclick="closeEpisodeModal()" style="background:none; border:none; color:#888; font-size:20px; cursor:pointer;">&times;</button>
            </div>
            <div id="episodeList" class="episode-list">
                 <!-- List injected -->
            </div>
        </div>
    </div>

    <!-- Config Modal -->
    <div id="configModal" class="modal-overlay">
        <div class="modal-box">
            <div class="modal-title">âš™ï¸ ì´ˆê¸° ì„¤ì •</div>
            <div class="modal-desc">
                TokiSync ë¼ì´ë¸ŒëŸ¬ë¦¬ í´ë”ì˜ IDë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.<br>
                (êµ¬ê¸€ ë“œë¼ì´ë¸Œ í´ë” URLì˜ ë’·ë¶€ë¶„)
            </div>
            <input type="text" id="configFolderId" class="config-input" placeholder="Folder ID">
            <button class="btn-save" onclick="saveConfig()">ì €ì¥í•˜ê¸°</button>

            <button class="btn-pwa" onclick="togglePwaGuide()">ğŸ“± ì•± ì„¤ì¹˜ ê°€ì´ë“œ (ë‹¤ì¤‘ ë¡œê·¸ì¸ í•´ê²°)</button>

            <div id="pwaGuide" class="pwa-guide">
                <strong>ğŸ’¡ ë‹¤ì¤‘ ê³„ì • ë¡œê·¸ì¸ ë¬¸ì œ í•´ê²°ë²•</strong><br>
                ì—¬ëŸ¬ êµ¬ê¸€ ê³„ì •ì„ ì‚¬ìš© ì¤‘ì´ë¼ë©´ ì„¤ì •ì´ ìê¾¸ í’€ë¦´ ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì•±ìœ¼ë¡œ ì„¤ì¹˜í•˜ì—¬ í•´ê²°í•˜ì„¸ìš”.<br><br>
                1. ì›í•˜ëŠ” ê³„ì •ìœ¼ë¡œ ë¡œê·¸ì¸ëœ í¬ë¡¬ ì°½ ì—´ê¸°<br>
                2. ìš°ì¸¡ ìƒë‹¨ <strong>ë©”ë‰´(â‹®)</strong> í´ë¦­<br>
                3. <strong>ë„êµ¬ ë”ë³´ê¸°</strong> > <strong>ë°”ë¡œê°€ê¸° ë§Œë“¤ê¸°</strong><br>
                4. <strong>"ì°½ìœ¼ë¡œ ì—´ê¸°"</strong> ì²´í¬ í›„ [ë§Œë“¤ê¸°]<br>
                5. ë°”íƒ•í™”ë©´ì— ìƒê¸´ ì•„ì´ì½˜ìœ¼ë¡œ ì‹¤í–‰í•˜ì„¸ìš”!
            </div>
        </div>
    </div>

    <header>
        <div class="header-top">
            <h1 onclick="location.reload()">ğŸ“š TokiLibrary</h1>
            <div class="controls">
                <input type="text" id="search" class="search-box" placeholder="ì œëª©, ì‘ê°€ ê²€ìƒ‰..." onkeyup="filterData()">
                <button id="refreshBtn" class="btn-icon btn-refresh" onclick="refreshDB()"
                    title="DB ê°±ì‹  (ìŠ¤ìº”)">ğŸ”„</button>
                <button class="btn-icon" onclick="toggleSettings()" title="ë„ë©”ì¸ ì„¤ì •">âš™ï¸</button>
            </div>
        </div>
        <div id="domainPanel">
            <div class="domain-row">
                <span class="domain-label">ë‰´í† ë¼:</span>
                <input type="text" id="url_newtoki" class="domain-input" placeholder="ì˜ˆ: https://newtoki469.com"
                    onchange="saveDomains()">
            </div>
            <div class="domain-row">
                <span class="domain-label">ë§ˆë‚˜í† ë¼:</span>
                <input type="text" id="url_manatoki" class="domain-input" placeholder="ì˜ˆ: https://manatoki469.net"
                    onchange="saveDomains()">
            </div>
            <div class="domain-row">
                <span class="domain-label">ë¶í† ë¼:</span>
                <input type="text" id="url_booktoki" class="domain-input" placeholder="ì˜ˆ: https://booktoki469.com"
                    onchange="saveDomains()">
            </div>
            <div style="font-size: 12px; color: #888; margin-top: 5px;">â€» ë„ë©”ì¸ì´ ë³€ê²½ë˜ë©´ ì—¬ê¸°ì„œ ìˆ˜ì •í•˜ì„¸ìš”. ë§í¬ê°€ ì¦‰ì‹œ ë°˜ì˜ë©ë‹ˆë‹¤.</div>
        </div>
    </header>

    <div class="container">
        <div id="grid" class="grid"></div>
    </div>

    <!-- Dynamic Manifest Injection -->
    <script>
        const manifest = {
            "name": "TokiView",
            "short_name": "TokiView",
            "start_url": ".",
            "display": "standalone",
            "background_color": "#1a1a1a",
            "theme_color": "#1a1a1a",
            "icons": [{
                "src": "https://github.com/user-attachments/assets/99f5bb36-4ef8-40cc-8ae5-e3bf1c7952ad",
                "sizes": "192x192",
                "type": "image/png"
            }]
        };
        const stringManifest = JSON.stringify(manifest);
        const blob = new Blob([stringManifest], { type: 'application/json' });
        const manifestURL = URL.createObjectURL(blob);
        const link = document.createElement('link');
        link.rel = 'manifest';
        link.href = manifestURL;
        document.head.appendChild(link);
    </script>
    
    <!-- Client Logic Module -->
    <?!= include('Client.js'); ?>
</body>

</html>